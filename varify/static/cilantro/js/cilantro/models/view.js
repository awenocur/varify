var __hasProp={}.hasOwnProperty,__extends=function(t,e){function n(){this.constructor=t}for(var i in e)__hasProp.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};define(["underscore","backbone","../core","./base"],function(t,e,n,i){var s,r,o,a,u,h,c;return s=function(t){function e(){return u=e.__super__.constructor.apply(this,arguments)}return __extends(e,t),e.prototype.idAttribute="concept",e}(e.Model),r=function(t){function e(){return h=e.__super__.constructor.apply(this,arguments)}return __extends(e,t),e.prototype.model=s,e}(e.Collection),a=function(e){function i(){this.facets=new r,this.on("change:json",function(t,e){return this.jsonToFacets(e)}),i.__super__.constructor.apply(this,arguments)}return __extends(i,e),i.prototype.initialize=function(){var t=this;return this.on("request",function(){return n.trigger(n.VIEW_SYNCING,this)}),this.on("sync",function(t,e,i){return null==i&&(i={}),i.silent!==!0?n.trigger(n.VIEW_SYNCED,this,"success"):void 0}),this.on("error",function(){return n.trigger(n.VIEW_SYNCED,this,"error")}),this.on("change",function(){return n.trigger(n.VIEW_CHANGED,this)}),n.on(n.VIEW_SAVE,function(e){return t.id===e||!e&&t.isSession()?t.save():void 0})},i.prototype.isSession=function(){return this.get("session")},i.prototype.isArchived=function(){return this.get("archived")},i.prototype.toJSON=function(){var t;return t=i.__super__.toJSON.apply(this,arguments),t.json=this.facetsToJSON(),t},i.prototype.parse=function(t){return i.__super__.parse.apply(this,arguments),this.jsonToFacets(t.json),t},i.prototype.jsonToFacets=function(e){var n,i,s,r,o,a,u,h,c,l,p,d,f;if(t.isArray(e))return this.facets.reset(e),void 0;for(o=[],i=e.columns||[],a=e.ordering||[],h=0,p=i.length;p>h;h++){for(r=i[h],n={concept:r},s=l=0,d=a.length;d>l;s=++l)f=a[s],c=f[0],u=f[1],r===c&&(n.sort=u,n.sort_index=s);o.push(n)}return this.facets.reset(o)},i.prototype.facetsToJSON=function(){var t;return t={ordering:[],columns:[]},this.facets.each(function(e){var n,i,s;return t.columns.push(e.get("concept")),(n=e.get("sort"))?(i=e.get("sort_index"),s=[e.get("concept"),n],t.ordering.splice(i,0,s)):void 0}),t},i}(i.Model),o=function(t){function e(){return c=e.__super__.constructor.apply(this,arguments)}return __extends(e,t),e.prototype.model=a,e}(i.SessionCollection),{ViewModel:a,ViewCollection:o}});
//@ sourceMappingURL=view.js.map