define(["underscore","cilantro"],function(e,t){var n=t.ui.ResultCount.extend({renderCount:function(t,n,r){var i,s=null;this.data.context!=null&&(i=this.data.context.get("json"))!=null&&e.each(i.children,function(e){e.concept!=null&&e.concept===2&&(s=e.children[0].value[0].label)}),numbers.renderCount(this.ui.count,n),this.ui.label.text("records in "+(s||"various samples")),this.ui.label.attr("title",s),s!=null?this.ui.label.tooltip({animation:!1,html:!0,placement:"bottom",container:"body"}):this.ui.label.tooltip("destroy")}}),r=t.ui.ResultsWorkflow.extend({template:"varify/workflows/results",_ui:{viewPhenotype:".phenotype-modal .modal-body .span12",recalculateButton:"[data-target=recalculate-rankings]",phenotypeWarning:"[data-target=phenotype-warning]"},_events:{"click .export-options-modal [data-save]":"onExportClicked","click .export-options-modal [data-dismiss=modal]":"onExportCloseClicked","show.bs.modal .phenotype-modal":"viewPhenotypesClicked","hidden.bs.modal .phenotype-modal":"hidePhenotypes","click [data-target=recalculate-rankings]":"recalculateRankingsClicked"},_regions:{resultDetailsModal:".result-details-modal"},initialize:function(){e.extend({},this._ui,this.ui),e.extend({},this._events,this.events),e.extend({},this._regions,this.regions),t.on("resultRow:click",function(e,t){this.resultDetailsModal.currentView.update(e,t)}),t.ui.ResultsWorkflow.prototype.initialize.call(this)},onExportCloseClicked:function(){e.delay(function(){this.columns.currentView.resetFacets()},25)},onExportClicked:function(){this.columns.currentView.data.facets.length===0?(this.$("#export-error-message").html("One or more columns must be selected. Click the &quot;Columns&quot; tab, add at least one column using the green &quot;plus&quot; buttons next to the column names, and click &quot;Export&quot; to try again."),this.$(".export-options-modal .alert-block").show()):e.isEqual(e.pluck(this.data.view.facets.models,"id"),e.pluck(this.columns.currentView.data.facets.models,"id"))?this.exportData():(this.data.view.facets.reset(this.columns.currentView.data.facets.toJSON()),this.data.view.save({},{success:this.exportData}))}});return{ResultsWorkflow:r}})